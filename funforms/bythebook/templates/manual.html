{% load staticfiles %}
<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" 
            src="{% static "js/jquery.js" %}"></script>

  </head>
  <body>    
    <form action="" method="POST">
      {% csrf_token %}
      <p>
        <label for="id_name">Name:</label> 
        {{ book.name }}
        {{ book.name.errors }}
      </p>
      <p>
        <label for="id_authors">Authors:</label>

        <div id="authors">
          {% for author in authors %}
          <div class="author">
            {{ author.title }}
            {{ author.name }}
            {{ author.name.errors }}
            {% if not forloop.first %}
            <button type="button">Remove</button>
            {% endif %}
          </div>
          {% endfor %}
        </div>
        <button type="button" id="add_author">Add Author</button>

        <div id="author_prototype" style="display:none">
          <div class="author">
            {{ author_prototype.title }}
            {{ author_prototype.name }}
            <button type="button">Remove</button>
          </div>
        </div>

        <div>
          Topic: {{ topic.name }}

          {% for error in topic.name.errors %}
          <span class="error">*</span><strong>{{ error|escape }}</strong>
          {% endfor %}

        </div>
      </p>
      <input type="submit" value="Send message">
    </form>

    <script>
      jQuery(function ($) {
        var bindRemove = function () {
          $elms = $(".author button");
          $elms.click(function (evt) {
             console.log('click');
             $(this).parents(".author").remove();
             $elms = $(".author button");
             if ($elms.length == 2) {
               $("button", $(".author")[0]).remove();
               return;
             }
           });
        };
        bindRemove();
        $("#add_author").click(function (evt) {
          var $proto = $($("#author_prototype").html());
          var $div = $("<div>");
          $div.append($proto);
          $("#authors").append($div);
          bindRemove();
        });


        
      });
    </script>
  </body>
</html>
